<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" crossorigin="anonymous">
<style>
    table {
      font-family: arial, sans-serif;
      border-collapse: collapse;
      width: 100%;
    }
    
    td, th {
      border: 1px solid #dddddd;
      text-align: left;
      padding: 8px;
    }
    
    tr:nth-child(even) {
      background-color: #dddddd;
    }
    .blue {
        color: blue;
    }
    .red {
        color: red;
    }
    
    .green {
        color: green;
    }
</style>

<script>
    window.setInterval('refresh()', 300000); 	
    // Call a function every 300000 milliseconds 
    // (OR every 5 minutes).

    // Refresh or reload page.
    function refresh() {
        window .location.reload();
    }
</script>

<div class="container text-center">
    <h1>Nifty and BankNifty Option Chain open interest data!!</h1>
    <br>
    <div class="row">
        {% if nifty %}
            <div class="col-sm">
                <b>Nifty50</b>
                <br>
                <table>
                    <tr>
                        <th>Time</th>
                        <th>Call</th>
                        <th>Put</th>
                        <th>Diff</th>
                        <th>PCR (On trial)</th>
                        <th>Option Signal</th>
                    </tr>
                    {% for obj in oc_oi_objs reversed %}
                        {% if obj.option_chain_symbol == 'nifty' %}
                            {% if obj.signal %}
                                <tr class="green">
                                    <td>{{ obj.timestamp }}</td>
                                    <td>{{ obj.total_CE_OI }}</td>
                                    <td>{{ obj.total_PE_OI }}</td>
                                    <td>{{ obj.diff }}</td>
                                    <td>{{ obj.diff_pcr }}</td>
                                    <td>BUY</td>
                                </tr>
                            {% else %}
                                <tr class="red">
                                    <td>{{ obj.timestamp }}</td>
                                    <td>{{ obj.total_CE_OI }}</td>
                                    <td>{{ obj.total_PE_OI }}</td>
                                    <td>{{ obj.diff }}</td>
                                    <td>{{ obj.diff_pcr }}</td>
                                    <td>SELL</td>
                                </tr>
                            {% endif %}
                        {% endif %}
                        
                    {% endfor%}
                </table>
            </div>
            <!-- <div class="col-sm">
                <b>Nifty50</b>
                <br>
                <table>
                    <tr>
                        <th>Major Support</th>
                        <th>Major Resistance</th>
                    </tr>
                    <tr class="blue">
                        <th>{{ nf_major_support }}</th>
                        <th>{{ nf_major_resistance }}</th>
                    </tr>
                </table>
                <table>
                    <tr>
                        <th>Time</th>
                        <th>Call</th>
                        <th>Put</th>
                        <th>Diff</th>
                        <th>PCR (On trial)</th>
                        <th>Option Signal</th>
                    </tr>
                    {% if nf_signal == 'BUY' %}
                        <tr class="green">
                            <td>{{ date_time }}</td>
                            <td>{{ nf_total_CE_OI }}</td>
                            <td>{{ nf_total_PE_OI }}</td>
                            <td>{{ nf_diff }}</td>
                            <td>{{ nf_diff_PCR }}</td>
                            <td>{{ nf_signal }}</td>
                        </tr>
                    {% else %}
                        <tr class="red">
                            <td>{{ date_time }}</td>
                            <td>{{ nf_total_CE_OI }}</td>
                            <td>{{ nf_total_PE_OI }}</td>
                            <td>{{ nf_diff }}</td>
                            <td>{{ nf_diff_PCR }}</td>
                            <td>{{ nf_signal }}</td>
                        </tr>
                    {% endif %}
                </table>
            </div> -->
        {% endif %}
        {% if banknifty %}
            <div class="col-sm">
                <b>BankNifty</b>
                <br>
                <!-- <table>
                    <tr>
                        <th>Major Support</th>
                        <th>Major Resistance</th>
                    </tr>
                    <tr class="blue">
                        <th>{{ bnf_major_support }}</th>
                        <th>{{ bnf_major_resistance }}</th>
                    </tr>
                </table> -->
                <table>
                    <tr>
                        <th>Time</th>
                        <th>Call</th>
                        <th>Put</th>
                        <th>Diff</th>
                        <th>PCR (On trial)</th>
                        <th>Option Signal</th>
                    </tr>
                    {% for obj in oc_oi_objs reversed %}
                        {% if obj.option_chain_symbol == 'banknifty' %}
                            {% if obj.signal %}
                                <tr class="green">
                                    <td>{{ obj.timestamp }}</td>
                                    <td>{{ obj.total_CE_OI }}</td>
                                    <td>{{ obj.total_PE_OI }}</td>
                                    <td>{{ obj.diff }}</td>
                                    <td>{{ obj.diff_pcr }}</td>
                                    <td>BUY</td>
                                </tr>
                            {% else %}
                                <tr class="red">
                                    <td>{{ obj.timestamp }}</td>
                                    <td>{{ obj.total_CE_OI }}</td>
                                    <td>{{ obj.total_PE_OI }}</td>
                                    <td>{{ obj.diff }}</td>
                                    <td>{{ obj.diff_pcr }}</td>
                                    <td>SELL</td>
                                </tr>
                            {% endif %}
                        {% endif %}
                    {% endfor%}
                </table>
            </div>
        {% endif %}
    </div>
    </div>